<div render-lucide-icons>
  <div class="flex justify-between items-center mb-8">
    <div><h1 class="text-3xl font-bold tracking-tight">Reclamações e Sugestões</h1><p class="text-muted-foreground">Gerencie as ocorrências do condomínio</p></div>
    <button ng-if="!isManager" ng-click="openNewComplaintModal()" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"><i data-lucide="plus" class="mr-2 h-4 w-4"></i><span>Nova Reclamação</span></button>
  </div>

  <div>
    <div class="inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground">
      <button ng-click="view.tab = 'open'" ng-class="{'bg-background text-foreground shadow-sm': view.tab === 'open'}" class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium">Em Aberto</button>
      <button ng-click="view.tab = 'solved'" ng-class="{'bg-background text-foreground shadow-sm': view.tab === 'solved'}" class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium">Resolvidas</button>
    </div>
    
    <div class="mt-4 space-y-4">
      <div ng-show="view.tab === 'open'"><div ng-if="!openComplaints.length" class="text-center text-muted-foreground py-8">Não há reclamações em aberto.</div><div ng-repeat="c in openComplaints" class="rounded-lg border bg-card text-card-foreground shadow-sm p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-lg font-medium">{{ c.title }} <span ng-if="isManager">- Apto {{c.unitNumber}}</span></h3><span class="text-sm text-muted-foreground">{{ c.createdAt }}</span></div><p class="text-sm mb-4">{{ c.description | limitTo: 150 }}{{c.description.length > 150 ? '...' : ''}}</p><div class="flex gap-2"><button ng-if="isManager" ng-click="openRespondModal(c)" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground h-9 px-3">Responder</button><button ng-click="openViewComplaintModal(c)" class="inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background h-9 px-3">Ver Detalhes</button></div></div></div>
      <div ng-show="view.tab === 'solved'"><div ng-if="!solvedComplaints.length" class="text-center text-muted-foreground py-8">Não há reclamações resolvidas.</div><div ng-repeat="c in solvedComplaints" class="rounded-lg border bg-card text-card-foreground shadow-sm p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-lg font-medium">{{ c.title }} <span ng-if="isManager">- Apto {{c.unitNumber}}</span></h3><span class="text-sm text-muted-foreground">{{ c.responseDate }}</span></div><p class="text-sm text-muted-foreground italic mb-2"><strong>Resolução:</strong> {{ c.response }}</p><button ng-click="openViewComplaintModal(c)" class="inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background h-9 px-3">Ver Detalhes</button></div></div>
    </div>
  </div>

  <div ng-show="newComplaintModal.isOpen" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4"><form ng-submit="submitNewComplaint()" class="relative rounded-lg border bg-card w-full max-w-lg"><div class="p-6" render-lucide-icons><h3 class="text-lg font-semibold">Nova Reclamação</h3><p class="text-sm text-muted-foreground">Descreva sua reclamação ou sugestão.</p><button type="button" ng-click="closeAllModals()" class="absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100"><i data-lucide="x" class="h-4 w-4"></i></button></div><div class="p-6 pt-0 space-y-4"><div class="space-y-2"><label class="text-sm font-medium">Título</label><input required placeholder="Título da reclamação" class="flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm" /></div><div class="space-y-2"><label class="text-sm font-medium">Descrição</label><textarea required placeholder="Descreva detalhadamente..." class="flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm"></textarea></div></div><div class="flex items-center p-6 justify-end"><button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground h-10 px-4 py-2">Enviar</button></div></form></div>
  <div ng-show="viewComplaintModal.isOpen" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4"><div class="relative rounded-lg border bg-card w-full max-w-lg"><div class="p-6" render-lucide-icons><h3 class="text-lg font-semibold">{{ viewComplaintModal.data.title }}</h3><p class="text-sm text-muted-foreground"><span ng-if="isManager">Unidade: {{viewComplaintModal.data.unitNumber}} • </span>Registrado em: {{viewComplaintModal.data.createdAt}}</p><button type="button" ng-click="closeAllModals()" class="absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100"><i data-lucide="x" class="h-4 w-4"></i></button></div><div class="p-6 pt-0 space-y-4"><p class="text-sm bg-muted p-3 rounded-md">{{ viewComplaintModal.data.description }}</p><div ng-if="viewComplaintModal.data.status === 'resolved'"><h4 class="font-medium text-sm mb-1">Resolução</h4><p class="text-sm bg-muted p-3 rounded-md">{{ viewComplaintModal.data.response }}<span class="block mt-2 text-xs text-muted-foreground">Resolvido em: {{viewComplaintModal.data.responseDate}}</span></p></div></div><div class="flex items-center p-6 justify-end"><button ng-click="closeAllModals()" class="inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background h-10 px-4 py-2">Fechar</button></div></div></div>
  <div ng-show="respondModal.isOpen" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4"><form ng-submit="markAsResolved()" class="relative rounded-lg border bg-card w-full max-w-lg"><div class="p-6" render-lucide-icons><h3 class="text-lg font-semibold">Responder Reclamação</h3><p class="text-sm text-muted-foreground">Forneça uma resposta ou solução.</p><button type="button" ng-click="closeAllModals()" class="absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100"><i data-lucide="x" class="h-4 w-4"></i></button></div><div class="p-6 pt-0 space-y-4"><div><h4 class="font-medium text-sm mb-1">Reclamação Original</h4><p class="text-sm bg-muted p-3 rounded-md">{{ respondModal.data.description }}</p></div><div class="space-y-2"><label class="text-sm font-medium">Sua Resposta</label><textarea ng-model="respondModal.responseText" placeholder="Digite sua resposta ou solução..." class="flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm"></textarea></div></div><div class="flex items-center p-6 justify-end"><button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground h-10 px-4 py-2">Marcar como Resolvido</button></div></form></div>
</div>